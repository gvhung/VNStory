function getRootUrl(){return window.location.protocol+"//"+window.location.hostname+(window.location.port&&window.location.port!={"http:":80,"https:":443}[window.location.protocol]?":"+window.location.port:"")}$(document).ready(function(){$("div#Nhap_Diem_ActionButton").hide();$("div#Xep_Loai_ActionButton").hide();$("select#Nhap_Diem_ListLopHoc").change(function(n){n.preventDefault();var t=$("select#Nhap_Diem_ListMonHoc").val(),i=$(this).val();t!=""&&i!=""?$.ajax({beforeSend:function(){$.blockUI()},complete:function(){$.unblockUI()},type:"POST",url:getRootUrl()+"/SoDiem/GetAllHocSinh",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({IdLopHoc:i,IdMonHoc:t}),async:!1,success:function(n){var u,e,v;if(n!=null&&n.length>0){var r="",f=n[0],o=n[1];if(f.length>0){for(u=0;u<f.length;u++){var s="0",h="",c="",l="",a="";if(o!=null)for(e=0;e<o.length;e++)if(o[e].MaHocSinh==f[u].Id){s=o[e].Id;h=o[e].TBHK1;c=o[e].TBHK2;l=o[e].HanhKiem;a=o[e].HocLuc;break}r+='<tr data-id="'+s+'" data-hs-id="'+f[u].Id+'" data-mh-id="'+t+'" data-lh-id="'+i+'"  data-hk="'+l+'"  data-hl="'+a+'">';r+="<td>"+f[u].SoTT+"<\/td>";r+="<td>"+f[u].MaHS+"<\/td>";r+="<td>"+f[u].HoVaTen+"<\/td>";v=new Date(parseInt(f[u].NgaySinh.replace(/(^.*\()|([+-].*$)/g,"")));r+="<td>"+$.format.date(v,"yyyy-MM-dd")+"<\/td>";r+="<td>"+f[u].GioiTinh+"<\/td>";r+='<td><input data-for="TBHK1" autocomplete="off" class="form-control" placeholder="Điểm TB HK1" type="text" value="'+h+'" ><\/td>';r+='<td><input data-for="TBHK2" autocomplete="off" class="form-control" placeholder="Điểm TB HK2" type="text" value="'+c+'"><\/td>';r+="<\/tr>"}$("div#Nhap_Diem_ActionButton").show()}else r+='<tr><td colspan="7">Không có bản ghi nào<\/td><\/tr>',$("div#Nhap_Diem_ActionButton").hide();$("tbody#Nhap_Diem_ListHocSinh").empty();$("tbody#Nhap_Diem_ListHocSinh").append(r)}},error:function(){alert("Có lỗi khi lấy dữ liệu")}}):($("tbody#Nhap_Diem_ListHocSinh").empty(),$("div#Nhap_Diem_ActionButton").hide())});$("select#Nhap_Diem_ListMonHoc").change(function(n){n.preventDefault();var t=$("select#Nhap_Diem_ListLopHoc").val(),i=$(this).val();t!=""&&i!=""?$.ajax({beforeSend:function(){$.blockUI()},complete:function(){$.unblockUI()},type:"POST",url:getRootUrl()+"/SoDiem/GetAllHocSinh",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({IdLopHoc:t,IdMonHoc:i}),async:!1,success:function(n){var u,e,v;if(n!=null&&n.length>0){var r="",f=n[0],o=n[1];if(f.length>0){for(u=0;u<f.length;u++){var s="0",h="",c="",l="",a="";if(o!=null)for(e=0;e<o.length;e++)if(o[e].MaHocSinh==f[u].Id){s=o[e].Id;h=o[e].TBHK1;c=o[e].TBHK2;l=o[e].HanhKiem;a=o[e].HocLuc;break}r+='<tr data-id="'+s+'" data-hs-id="'+f[u].Id+'" data-mh-id="'+i+'" data-lh-id="'+t+'"  data-hk="'+l+'"  data-hl="'+a+'">';r+="<td>"+f[u].SoTT+"<\/td>";r+="<td>"+f[u].MaHS+"<\/td>";r+="<td>"+f[u].HoVaTen+"<\/td>";v=new Date(parseInt(f[u].NgaySinh.replace(/(^.*\()|([+-].*$)/g,"")));r+="<td>"+$.format.date(v,"yyyy-MM-dd")+"<\/td>";r+="<td>"+f[u].GioiTinh+"<\/td>";r+='<td><input data-for="TBHK1" autocomplete="off" class="form-control" placeholder="Điểm TB HK1" type="text" value="'+h+'" ><\/td>';r+='<td><input data-for="TBHK2" autocomplete="off" class="form-control" placeholder="Điểm TB HK2" type="text" value="'+c+'"><\/td>';r+="<\/tr>"}$("div#Nhap_Diem_ActionButton").show()}else r+='<tr><td colspan="7">Không có bản ghi nào<\/td><\/tr>',$("div#Nhap_Diem_ActionButton").hide();$("tbody#Nhap_Diem_ListHocSinh").empty();$("tbody#Nhap_Diem_ListHocSinh").append(r)}},error:function(){alert("Có lỗi khi lấy dữ liệu")}}):($("tbody#Nhap_Diem_ListHocSinh").empty(),$("div#Nhap_Diem_ActionButton").hide())});$("button#Nhap_Diem_Button_Luu").click(function(){var n=[];$("tbody#Nhap_Diem_ListHocSinh").children("tr").each(function(){var i;if($(this).attr("data-id")!=null){var t={},o=$(this).attr("data-id"),s=$(this).attr("data-hs-id"),h=$(this).attr("data-mh-id"),r=$(this).attr("data-hk"),u=$(this).attr("data-hl"),f=$(this).find("input[type=text]:eq(0)").val(),e=$(this).find("input[type=text]:eq(1)").val();t.Id=parseInt(o);t.MaHocSinh=parseInt(s);t.MaMonHoc=parseInt(h);t.TBHK1=f!=""?parseFloat(f):0;t.TBHK2=e!=""?parseFloat(e):0;i=(t.TBHK2*2+t.TBHK1)/3;t.TBCN=i;u=i>8?"Giỏi":i>parseFloat("6.5")?"Khá":i>5?"Trung bình":i>parseFloat("3.5")?"Yếu":"Kém";t.HocLuc=u;r=="null"&&(r="");t.HanhKiem=r;n.push(t)}});n.length>0&&$.ajax({beforeSend:function(){$.blockUI()},complete:function(){$.unblockUI()},type:"POST",url:getRootUrl()+"/SoDiem/UpdateAllHocSinh",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({listSoDiem:n}),async:!1,success:function(n){var i,u,l;if(n!=null&&n.length>0){var t="",r=n[0],f=n[1],a=$("select#Nhap_Diem_ListLopHoc").val(),v=$("select#Nhap_Diem_ListMonHoc").val();if(r.length>0){for(i=0;i<r.length;i++){var e="",o="",s="",h="",c="";if(f!=null)for(u=0;u<f.length;u++)if(f[u].MaHocSinh==r[i].Id){e=f[u].Id;o=f[u].TBHK1;s=f[u].TBHK2;h=f[u].HanhKiem;c=f[u].HocLuc;break}t+='<tr data-id="'+e+'" data-hs-id="'+r[i].Id+'" data-mh-id="'+v+'" data-lh-id="'+a+'"  data-hk="'+h+'"  data-hl="'+c+'">';t+="<td>"+r[i].SoTT+"<\/td>";t+="<td>"+r[i].MaHS+"<\/td>";t+="<td>"+r[i].HoVaTen+"<\/td>";l=new Date(parseInt(r[i].NgaySinh.replace(/(^.*\()|([+-].*$)/g,"")));t+="<td>"+$.format.date(l,"yyyy-MM-dd")+"<\/td>";t+="<td>"+r[i].GioiTinh+"<\/td>";t+='<td><input data-for="TBHK1" autocomplete="off" class="form-control" placeholder="Điểm TB HK1" type="text" value="'+o+'" ><\/td>';t+='<td><input data-for="TBHK2" autocomplete="off" class="form-control" placeholder="Điểm TB HK2" type="text" value="'+s+'"><\/td>';t+="<\/tr>"}$("div#Nhap_Diem_ActionButton").show()}else t+='<tr><td colspan="7">Không có bản ghi nào<\/td><\/tr>',$("div#Nhap_Diem_ActionButton").hide();$("tbody#Nhap_Diem_ListHocSinh").empty();$("tbody#Nhap_Diem_ListHocSinh").append(t)}},error:function(){alert("Có lỗi khi lấy dữ liệu")}})});$("button#Nhap_Diem_Button_Xoa").click(function(){$("tbody#Nhap_Diem_ListHocSinh").children("tr").each(function(){$(this).attr("data-id")!=null})});$("select#Xep_Loai_ListLopHoc").change(function(n){n.preventDefault();var t=$("select#Xep_Loai_ListMonHoc").val(),i=$(this).val();t!=""&&i!=""?$.ajax({beforeSend:function(){$.blockUI()},complete:function(){$.unblockUI()},type:"POST",url:getRootUrl()+"/SoDiem/GetAllHocSinh",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({IdLopHoc:i,IdMonHoc:t}),async:!1,success:function(n){var u,f,y;if(n!=null&&n.length>0){var r="",e=n[0],o=n[1];if(e.length>0){for(u=0;u<e.length;u++){var v="0",s="",h="",c="",l="",a="";if(o!=null)for(f=0;f<o.length;f++)if(o[f].MaHocSinh==e[u].Id){v=o[f].Id;s=o[f].TBHK1;h=o[f].TBHK2;c=o[f].TBCN;l=o[f].HanhKiem;a=o[f].HocLuc;break}r+='<tr data-id="'+v+'" data-hs-id="'+e[u].Id+'" data-mh-id="'+t+'" data-lh-id="'+i+'"  data-hk="'+l+'" data-hl="'+a+'" data-tbhk1="'+s+'" data-tbhk2="'+h+'" data-tbcn="'+c+'">';r+="<td>"+e[u].SoTT+"<\/td>";r+="<td>"+e[u].MaHS+"<\/td>";r+="<td>"+e[u].HoVaTen+"<\/td>";y=new Date(parseInt(e[u].NgaySinh.replace(/(^.*\()|([+-].*$)/g,"")));r+="<td>"+$.format.date(y,"yyyy-MM-dd")+"<\/td>";r+="<td>"+e[u].GioiTinh+"<\/td>";r+="<td>"+s+"<\/td>";r+="<td>"+h+"<\/td>";r+="<td>"+c+"<\/td>";r+="<td>"+a+"<\/td>";r+='<td><input data-for="HanhKiem" autocomplete="off" class="form-control" placeholder="Hạnh kiểm" type="text" value="'+l+'"><\/td>';r+="<\/tr>"}$("div#Xep_Loai_ActionButton").show()}else r+='<tr><td colspan="7">Không có bản ghi nào<\/td><\/tr>',$("div#Xep_Loai_ActionButton").hide();$("tbody#Xep_Loai_ListHocSinh").empty();$("tbody#Xep_Loai_ListHocSinh").append(r)}},error:function(){alert("Có lỗi khi lấy dữ liệu")}}):($("tbody#Xep_Loai_ListHocSinh").empty(),$("div#Xep_Loai_ActionButton").hide())});$("select#Xep_Loai_ListMonHoc").change(function(n){n.preventDefault();var t=$("select#Xep_Loai_ListLopHoc").val(),i=$(this).val();t!=""&&i!=""?$.ajax({beforeSend:function(){$.blockUI()},complete:function(){$.unblockUI()},type:"POST",url:getRootUrl()+"/SoDiem/GetAllHocSinh",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({IdLopHoc:t,IdMonHoc:i}),async:!1,success:function(n){var u,f,y;if(n!=null&&n.length>0){var r="",e=n[0],o=n[1];if(e.length>0){for(u=0;u<e.length;u++){var v="0",s="",h="",c="",l="",a="";if(o!=null)for(f=0;f<o.length;f++)if(o[f].MaHocSinh==e[u].Id){v=o[f].Id;s=o[f].TBHK1;h=o[f].TBHK2;c=o[f].TBCN;l=o[f].HanhKiem;a=o[f].HocLuc;break}r+='<tr data-id="'+v+'" data-hs-id="'+e[u].Id+'" data-mh-id="'+i+'" data-lh-id="'+t+'"  data-hk="'+l+'" data-hl="'+a+'" data-tbhk1="'+s+'" data-tbhk2="'+h+'" data-tbcn="'+c+'">';r+="<td>"+e[u].SoTT+"<\/td>";r+="<td>"+e[u].MaHS+"<\/td>";r+="<td>"+e[u].HoVaTen+"<\/td>";y=new Date(parseInt(e[u].NgaySinh.replace(/(^.*\()|([+-].*$)/g,"")));r+="<td>"+$.format.date(y,"yyyy-MM-dd")+"<\/td>";r+="<td>"+e[u].GioiTinh+"<\/td>";r+="<td>"+s+"<\/td>";r+="<td>"+h+"<\/td>";r+="<td>"+c+"<\/td>";r+="<td>"+a+"<\/td>";r+='<td><input data-for="HanhKiem" autocomplete="off" class="form-control" placeholder="Hạnh kiểm" type="text" value="'+l+'"><\/td>';r+="<\/tr>"}$("div#Xep_Loai_ActionButton").show()}else r+='<tr><td colspan="7">Không có bản ghi nào<\/td><\/tr>',$("div#Xep_Loai_ActionButton").hide();$("tbody#Xep_Loai_ListHocSinh").empty();$("tbody#Xep_Loai_ListHocSinh").append(r)}},error:function(){alert("Có lỗi khi lấy dữ liệu")}}):($("tbody#Xep_Loai_ListHocSinh").empty(),$("div#Xep_Loai_ActionButton").hide())});$("button#Xep_Loai_Button_Luu").click(function(){var n=[];$("tbody#Xep_Loai_ListHocSinh").children("tr").each(function(){if($(this).attr("data-id")!=null){var t={},f=$(this).attr("data-id"),e=$(this).attr("data-hs-id"),o=$(this).attr("data-mh-id"),s=$(this).attr("data-hl"),i=$(this).attr("data-tbhk1"),r=$(this).attr("data-tbhk2"),u=$(this).attr("data-tbcn"),h=$(this).find("input[type=text]:eq(0)").val();t.Id=parseInt(f);t.MaHocSinh=parseInt(e);t.MaMonHoc=parseInt(o);t.TBHK1=i!=""?parseFloat(i):0;t.TBHK2=r!=""?parseFloat(r):0;t.TBCN=u!=""?parseFloat(u):0;t.HocLuc=s;t.HanhKiem=h;n.push(t)}});n.length>0&&$.ajax({beforeSend:function(){$.blockUI()},complete:function(){$.unblockUI()},type:"POST",url:getRootUrl()+"/SoDiem/UpdateAllHocSinh",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({listSoDiem:n}),async:!1,success:function(n){var i,r,a;if(n!=null&&n.length>0){var t="",u=n[0],f=n[1],v=$("select#Nhap_Diem_ListLopHoc").val(),y=$("select#Nhap_Diem_ListMonHoc").val();if(u.length>0){for(i=0;i<u.length;i++){var l="0",e="",o="",s="",h="",c="";if(f!=null)for(r=0;r<f.length;r++)if(f[r].MaHocSinh==u[i].Id){l=f[r].Id;e=f[r].TBHK1;o=f[r].TBHK2;s=f[r].TBCN;h=f[r].HanhKiem;c=f[r].HocLuc;break}t+='<tr data-id="'+l+'" data-hs-id="'+u[i].Id+'" data-mh-id="'+y+'" data-lh-id="'+v+'"  data-hk="'+h+'" data-hl="'+c+'" data-tbhk1="'+e+'" data-tbhk2="'+o+'" data-tbcn="'+s+'">';t+="<td>"+u[i].SoTT+"<\/td>";t+="<td>"+u[i].MaHS+"<\/td>";t+="<td>"+u[i].HoVaTen+"<\/td>";a=new Date(parseInt(u[i].NgaySinh.replace(/(^.*\()|([+-].*$)/g,"")));t+="<td>"+$.format.date(a,"yyyy-MM-dd")+"<\/td>";t+="<td>"+u[i].GioiTinh+"<\/td>";t+="<td>"+e+"<\/td>";t+="<td>"+o+"<\/td>";t+="<td>"+s+"<\/td>";t+="<td>"+c+"<\/td>";t+='<td><input data-for="HanhKiem" autocomplete="off" class="form-control" placeholder="Hạnh kiểm" type="text" value="'+h+'"><\/td>';t+="<\/tr>"}$("div#Xep_Loai_ActionButton").show()}else t+='<tr><td colspan="7">Không có bản ghi nào<\/td><\/tr>',$("div#Xep_Loai_ActionButton").hide();$("tbody#Xep_Loai_ListHocSinh").empty();$("tbody#Xep_Loai_ListHocSinh").append(t)}},error:function(){alert("Có lỗi khi lấy dữ liệu")}})});$("button#Xep_Loai_Button_Xoa").click(function(){$("tbody#Xep_Loai_ListHocSinh").children("tr").each(function(){$(this).attr("data-id")!=null})});$("select#Home_ListLopHoc").change(function(){window.location.href=getRootUrl()+"/Home/LopHoc?id="+$(this).val()})});